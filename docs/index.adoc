= Bareboat Necessities Projects
mgrouch <mgrouch@users.noreply.github.com>
0.6, Jan 9, 2020, Bareboat Projects
:toc:
:toclevels: 4
:sectnums:
:sectnumlevels: 3
:encoding: utf-8
:lang: en
:title-logo-image: image:../../bareboat-necessities-logo.svg[Bareboat Necessities Logo]
:imagesdir: images
:icons: font
ifdef::env-github[]
:tip-caption: :bulb:
:note-caption: :information_source:
:important-caption: :heavy_exclamation_mark:
:caution-caption: :fire:
:warning-caption: :warning:
endif::[]
:toc-placement!: manual
:env-github:

{zwsp} +

image::../../bareboat-necessities-logo.svg[Bareboat Necessities Logo]

{zwsp} +

https://github.com/bareboat-necessities/my-bareboat

{zwsp} +

== Boat Electronics Project

This document describes a DIY project of building a marine computer, a boat LTE/WiFi gateway, and
a cockpit chartplotter display from easily obtainable and affordable components.
This boating electronics project includes:

* Waterproof marine touch screen HDMI display
* GNSS (GPS, GLONASS, Beidou, Galileo) receiver
* Sensors for orientation (gyroscope, accelerometer, compass via IMU)
* AIS radar
* Environment temperature, barometric pressure, humidity sensors
* Connections to the boat instruments such as wind, depth, speed, AIS via NMEA 0183 serial ports
* Boat LTE / 4G Gateway, network storage
* Boat WiFi hotspot and a router with WiFi extender and a long range waterproof WiFi antenna
* Optional autopilot integration, rudder angle sensor
* Other NMEA devices, engine/battery status, bilge pump monitoring, etc
* Optional air mouse with a wireless keyboard and a touchpad
* Lightning EMI sensor and alarm
* RTL-SDR for weather fax, satellite weather, AIS, RTL 433, morse code decoder, etc
* Boat IoT Integration via MQTT
* Can be used with Iridium Satellite Modems
* Can be used for processing transmissions received from SSB radio via audio interface
* Variety of options of using wireless handheld devices such as smart phones and tablets
to connect to boat systems via WiFi and bluetooth. There are many marine applications available for
smart phones and tablets.

The boat computer is connected to the waterproof HDMI touchscreen in the cockpit.

*Boat Computer View*

.Boat Computer View
image::computer-front-panel.jpg[alt="Boat Computer Front View", width="75%", align="center"]

{zwsp} +

*Boat Gateway View*

.Boat Gateway View
image::boat-router/boat-router.jpg[alt="Boat Gateway Front View", width="75%", align="center"]

{zwsp} +

NOTE: Keep in mind that following this document you are building devices to be used in marine environment.
All connections and wiring need to follow marine standards which are more strict than automotive. All nuts and bolts
needs to be properly tightened. I've run into issues in my sailboat experience on water just because of
one missing washer  (It was in mechanical system on gear switch wire). Heat shrink tubing, wire grades are different
for marine standards. Corrosion in misty salt water air is much higher than on the ground. A boat is exposed
to elements more than house or automobile appliances. If you doubt you did something right you better of
revisiting it or seeking peer review from  other sailors. Same works the other way. If you see something wrong
here with the design let us know :) There is issues reporting system in GitHub:
https://github.com/bareboat-necessities/my-bareboat/issues

NOTE: Although this document describes mostly instructions on building hardware components, it is designed in
the spirit of open source development. We hope this design is going to evolve and have numerous releases and corrections
if it gains some community. Some software components might become part of this too. Cost cutting is another sport and
sub-hobby in recreational sailing and boating. So if same functionality can be built cheaper it probably should be, and
here is the reason to change this document.

=== Boat Computer

The boat computer runs on Raspberry Pi (Raspbian Linux) with OpenPlotter 2.0 installed. The boat computer will reside
below deck so it's not going to be waterproof. The touchscreen display runs OpenPlotter UI with OpenCPN chartplotter
and dashboards as well as general Linux UI.

*The boat computer front panel interfaces:*

* 1 USB 3.0 data port
* 1 AUX audio port
* 1 USB 2.0 data port
* 1 HDMI port
* Computer Voltage Meter
* Combined device Amp and Voltage meter
* Status indicators via fiber-optic light pipes
* Fuse box panel mount
* On/Off power switch
* On/Off power switch for cockpit instruments

{zwsp} +

.Boat Computer Front Panel
image::front-panel-intf.jpg[alt="Boat Computer Front Panel", width="75%", align="center"]

{zwsp} +

*The boat computer back panel interfaces:*

* 1 Ethernet port 1Gbit (for the WiFi router)
* 1 USB 2.0 port for GPS (or something else)
* 1 NMEA-0183 port (More can be added in same DYI fashion)
* DC power 2-wire input cord mounted inside a waterproof gland for 12v boat connection. SAE-type connector
* DC power 2-wire output cord mounted inside a waterproof gland for 12v cockpit connection. SAE-type connector
(black male)
* HDMI and USB 3.0 connectors to the cockpit display and touchscreen
* RF connector for AIS antenna
* RF connector for RTL-SDR antenna
* SMA RF connector for a secondary GPS

{zwsp} +

.Boat Computer Back Panel
image::back-panel-intf.jpg[alt="Boat Computer Back Panel", width="75%", align="center"]

{zwsp} +

*Boat Computer Inside View*

NOTE: Raspberry Pi lays on top of middle divider made out of plastic sheet. The power supply (12v to 5v step-down
converter) is mounted from the other side under the middle divider. The USB hub doesn't fit by height to simply lay
on the divider, so there is a little shelf made out of same plastic sheet and it is attached by 4 shortest
standoffs. USB hub is mounted a bit under angle to give space for a screw which closes the enclosure.


.Boat Computer Inside View
image::computer-internals.jpg[alt="Boat Computer Inside View", width="75%", align="center"]

{zwsp} +

On the picture 7-Port powered USB 3.0 hub, dAISy AIS, Raspberry Pi 4 with a cooling fan and heat sinks,
serial-to-USB stick (with the chipset from FTDI), SSD, RTL-SDR RF stick. 12v to 5v step-down converter is
located below this layer inside the housing box and is connected to the front panel via a fuse and
a switch on the front panel.

You can customize the front and back panels for your needs.

==== Basic Schematics

.Boat Computer Basic Schematics Diagram
image::boat-computer.svg[alt="Boat Computer Basic Schematics Diagram"]

{zwsp} +

Raspberry Pi 4 has also WiFi and BlueTooth interfaces:

* 802.11ac/n
* Bluetooth 5.0

WiFi can be used to set up access to the boat computer from smart phones and tablets
with additional software.

==== Boat Computer Enclosure

===== Enclosure Parts



[cols="4", options="header"]
|===



|Item
|Description
|Cost
|Source



| Case
a| Brand: SZOMK,  Model: AK-D-09, IP54 protection, plastic box for PCB design instrument. Black.
Dimensions exterior: W 230mm, D 210mm, H 86mm

* Brand (from inside markings): BAHAR
* Model: BDH 20014-A2

https://szomk.en.alibaba.com/product/60455131585-213058437/Customized_case_box_enclosure_for_gsm_modem_plastic_enclosures.html

| $17.10, Delivery: $13 | Alibaba



| Plastic sheets

a|ABS Black Plastic Sheets Size 12" x 12", 0.118"-1/8" thick, 2-Pack, 1 Side Textured, Black

https://www.ebay.com/itm/ABS-Black-Plastic-Sheets-You-Pick-The-Size-1-2-4-8-Pack-Options-1-Side-Textured/142746168237

| $19.20 | Ebay



| 12v to 5v step-down converter

a|TOBSUN EA50-5V DC 12V 24V to DC 5V 10A 50W Converter Regulator 5V 50W Power Supply Step Down Module Transformer

* Over-voltage, over-current, over-temperature, short-circuit auto protection
* Input voltage: 12/24V, Output: 5V/10A

https://www.amazon.com/dp/B01M03288J

| $9.60 | Amazon



| Screws, Nuts

a| Screws, nuts, etc for electronics

| $4.5 | Microcenter



| Standoffs
a| Hilitchi 120Pcs M3 Nylon Hex Spacers Screw Nut Standoff Plastic Accessories Assortment (Black)

* UNSPSC Code: 31161816
* Thread Size: M3
* Part Number: HNLM3

https://www.amazon.com/dp/B012G6E62I

| $6 | Amazon



| Cable ties
a| Cable ties

| $5 | Homedepot



| Soldering
a| Soldering Iron Kit - Soldering Iron 60 W Adjustable Temperature, Digital Multimeter, Wire Cutter,
Stand, Soldering Iron Tip Set, Desoldering Pump, Solder Wick, Tweezers, Rosin, Wire - [110 V, US Plug]

* Heat Time: 60 seconds
* Wattage: 60
* UNSPSC Code: 41110000

https://www.amazon.com/dp/B07Q2B4ZY9

| $35 | Amazon

|===


For those who like 3D printing and designing your own enclosures there is a nice
project with https://www.openscad.org/[OpenScad] on ThingsVerse. See:

https://www.thingiverse.com/thing:1264391  and

https://www.thingiverse.com/thing:1355018

It's called 'The Ultimate Box Maker'.


===== Front Panel

.Front Panel Diagram
image::front-panel.svg[alt="Front Panel Diagram"]

{zwsp} +

[cols="4", options="header"]
|===



|Item
|Description
|Cost
|Source



| 2-Wire DC connector (Red, **Black**)

a| SAE Connector DC Power Cable, 16 AWG Quick Disconnect, Dust Cap (6 Pcs 1.2 Foot)

https://www.amazon.com/dp/B07MP9MYKP

| $13 | Amazon



| 2-Wire DC connector (Red, **White**)

a| SAE Connector DC Power Cable, 16 AWG Quick Disconnect

NOTE: Used with 5v to distinguish from red/black for 12v

| $3 | Autozone



| USB 2.0 / HDMI

a| USB 2.0 HDMI Mount Cable – USB Extension Flush, Dash, Panel Mount Boat Cable (3.3FT/1m)

https://www.amazon.com/dp/B076DFRPLZ

| $10 | Amazon



| USB 3.0 / AUX

a| USB 3.0 & Flush Mount Cable + USB3.0 AUX Extension Dash Panel Waterproof Mount Cable
for Boat, Car and Motorcycle - 3ft

https://www.amazon.com/dp/B072KGMJ5N

| $10 | Amazon



| Panel, etc

a| Cllena Dual USB Socket Charger 2.1A&2.1A + LED Voltmeter + 12V Power Outlet + 5 Gang ON-Off Toggle Switch
Multi-Functions Panel for Car Boat Marine RV Truck Camper Vehicles GPS Mobiles

https://www.amazon.com/dp/B0785LZQLK

NOTE: Used for panel parts: Voltmeter, Switches, Fuses, 12v DC Wires

| $34 | Amazon



| Light Pipes
a| Fiber optic light pipes with lenses for panel mount for transfer of inside LED indicators light
to the front panel

* SMFLP12.0 492-1291-ND LIGHT PIPE CLEAR FLEXIBLE 12" (10 pack)

* Brand: Bivar Inc

* 4mm Board/Panel Mount

https://www.digikey.com/product-detail/en/bivar-inc/SMFLP12.0/492-1291-ND/2407239

| $28, Delivery: $9 | DigiKey



| Fuse Box for Panel Mount

a| Pack of 10 AC 15A 125V Black Electrical Panel Mounted Screw Cap Fuse Holder

* Fit for: 6 x 30mm fuses
* Rated: AC 125V 15A

https://www.amazon.com/dp/B012CTCWES

| $6 | Amazon



| Heat Shrink
a| 450pcs Heat Shrink Wire Connectors DIY Kit Heat Shrink Butt Connectors Crimping Tool Heat Shrink Tubing Heat Gun
Waterproof Marine Automotive Terminals Set

https://www.amazon.com/dp/B07W41Y7CF

| $42 | Amazon

|===

===== Back Panel

[cols="4", options="header"]
|===



|Item
|Description
|Cost
|Source


| RF connector for RTL-SDR to panel

a| SMA Male to UHF PL-259 Male RG316 RF Coax Cable 1 ft

* Impedance: 50 ohm; Length: 1 ft
* Ultra Low-loss Double Shielded RG316 Coaxial Cable

https://www.amazon.com/dp/B07TF6LZC7

| $11.30 | Amazon



| RF Connector to panel

a| SMA Socket Connector Panel Chassis Mount SMA Female to Female Bulkhead Extendable Antenna Jack Adapter
for Antennas Wireless LAN Devices Coaxial Cable, Pack of 2

* Antenna cable connector SMA female to female bulkhead jack adapter
* Surface treatment: Gold-plated, Impedance: 50ohm, Low-loss

https://www.amazon.com/dp/B07FKPJ4QQ

| $6 | Amazon



| AIS Antenna panel connector

a| 2pcs SO239 Adapter UHF Female to Female Jack Bulkhead RF Connector, Impedance:50 Ohm

https://www.amazon.com/dp/B01MR16V5X

| $9.60 | Amazon



| RF chord for dAISy AIS

a| BNC Male to PL259 RG58 Cable (8 Inches); UHF PL259 Jack to BNC Male Plug Adapter Jumper Pigtail Cable RG58

* Connector: BNC Male to PL259
* Impedance: 50 Ohm
* Cable Type: RG58

https://www.amazon.com/dp/B07MK8FM94

| $5.60 | Amazon



| RJ45

a| CAT6 RJ45 Shielded Industrial Panel Mount Bulkhead Female/Female Feed Thru Coupler -
Network Connectors - IP67 Waterproof/Dust Cap (Single Pack, Black)

https://www.amazon.com/dp/B01D0N7AI8

| $11.50 | Amazon



| Breadboard
a| Electronics-Salon 4x Prototype Breakout PCB Shield Board Kit for Raspberry Pi 3 2 B+ A+, Breadboard DIY

https://www.amazon.com/dp/B07BF8Z3HS

| $15 | Amazon



| Terminal Block for NMEA 0183

a| Brand Name: QSU

Screw Terminal Block Kit **Long** Pins 5 mm Pitch 2, 3, 4 Pole (40 pcs)

https://www.amazon.com/dp/B07RTHD45H

| $9.50 | Amazon



| USB 2.0 Panel Mount

a| USB2.0 IP67 Waterproof Connector Industrial Standard Double Head Coupler Adapter Female to Female Socket
Plug Panel Mount with Waterproof/Dust Cap, 2pcs

https://www.amazon.com/dp/B07RPW5XGB

| $13 for 2 | Amazon



| Waterproof Cable Glands

a| 35pcs Cable Gland Waterproof Cable Fixing Head Suitable for 3mm-14mm M12 M16 M18 M20 M22 Cable Gland Joints Assortment Set (M-Black)

https://www.amazon.com/dp/B07TSC34D5

| $11 | Amazon



| HDMI adapters
a| Cable Matters 2-Pack Micro HDMI to HDMI Adapter (HDMI to Micro HDMI Adapter) 6 Inches with 4K and HDR Support

https://www.amazon.com/dp/B00JDRHQ58

| $9 | Amazon



| GPS G-mouse
a| GlobalSat BU-353-S4 USB GPS Receiver (Black)

* 48-Channel All-In-View Tracking
* SiRF Star IV GPS Chipset
* WAAS/ EGNOS Support

https://www.amazon.com/dp/B008200LHW

| $26.10 | Amazon



| GPS Antenna

a| Waterproof Active GPS Antenna with Magnetic Base - 28dB - 3-5V - SMA Connector and Adapter Included

* compatible with BerryGPS-IMU
* Magnetic base for easy placement
* Cable length is 3 meters[9.8 Feet]
* Includes SMA to uFL connector
* Active 28dB

https://www.amazon.com/dp/B0769FRT6X

| $11.50 | Amazon



| Optional GPS Antenna

a| GPS Boat Antenna Compatible with Beidou 30dB SMA Male External Navigation Receiver 0.2 Meter Wire

* Connector: SMA Male
* Voltage: 3-5 Volt
* LNA Gain (Without Cable): 30dB
* Operating Temperature (Deg.C): -45~+85
* Center Frequency: 1575.42 MHz(GPS); 1561 MHz(BD)

https://www.amazon.com/dp/B07ZBVG1PK

| $16.25 | Amazon

|===


===== Assembly Activities

Make sure you use correct tools for:

* Measuring
* Cutting
* Clamping
* Drilling
* Heat Shrinking
* Tying
* Crimping
* Screwing

===== Tools

 Drill, Screwdriver, Drill bits, Large hole drill bit, Cutting knife, Caliper,
 Soldering Kit, Rotary Tool (Like Dremel), Heat Gun, Crimper Tool



==== Computer and Sensors

===== Raspberry Pi 4

.Raspberry Pi 4 Diagram
image::RaspberryPi_4_Model_B.svg[alt="Raspberry Pi 4 Diagram"]

{zwsp} +

This file is licensed under the Creative Commons Attribution-Share Alike 4.0 International license

https://creativecommons.org/licenses/by-sa/4.0/deed.en

====== Sensors and Parts

[cols="4", options="header"]
|===



|Item
|Description
|Cost
|Source



| Pi 4
a| Raspberry Pi 4, 4Gb + Power Supply

| $65 | Amazon



| Heat sinks and Cooling fan, Case

a| Acrylic Case for Raspberry Pi 4 Model B & Raspberry Pi 3 Model B+, Raspberry Pi Case with Cooling Fan and
7PCS Heatsinks for Raspberry Pi 3/2 Model B/B+ (Brown)

https://www.amazon.com/dp/B07T3DRB1C

| $9 | Amazon




| USB Hub

a| USBGear 7-Port USB 3.0 Charging and SuperSpeed Mountable Data Hub

https://www.amazon.com/dp/B012DZ4RJY

| $35 | Amazon



| FTDI Serial to USB (2pcs)

a| DSD TECH SH-U11 USB to RS485 RS422 Converter with FTDI FT232 Chip Compatible with Windows 10, 8, 7, XP and Mac OS X

https://www.amazon.com/dp/B07B416CPK

| $34 (for 2) | Amazon



| SSD Drive
a| TBD: Model
| $45 | Amazon



| SD Card
a| TBD: Model
| $25 | Amazon



| dAISy AIS + BNC Adapter
a|
https://shop.wegmatt.com/products/daisy-ais-receiver?variant=7104299008036

| $67.70 | wegmatt.com



| RTL-SDR

a| RTL-SDR Blog V3 R820T2 RTL2832U 1PPM TCXO HF Bias Tee SMA Software Defined Radio with Dipole Antenna Kit

https://www.amazon.com/dp/B011HVUEME

| $30 | Amazon




| IMU + environmental sensors

a| BerryGPS-IMUv3 - GPS and 10DOF for The Raspberry Pi - Accelerometer, Gyroscope, Magnetometer and Barometric/Altitude Sensor

https://www.amazon.com/dp/B072MNBC9M

| $53.50 | Amazon



| Tram VHF Marine Antenna
a| https://www.amazon.com/dp/B01DUSBJ94

 For AIS

| $24.15 | Amazon



| Jumper Wires
a| 120pcs Breadboard Jumper Wires 10cm 15cm 20cm 30cm 40cm 50cm 100cm Optional Arduino Wire Dupont Cable Assorted
Kit Male to Female Male to Male Female to Female Multicolored Ribbon Cables

https://www.amazon.com/dp/B07GD2BWPY

| $5.80 | Amazon



| Waterproofing Spray for PCB, Conformal Coating

a| 422B-340G Silicone Conformal Coating, Clear, 12 oz Aerosol

https://www.amazon.com/dp/B008O9YGQI

| $22.45 | Amazon

| RTC Clock
a| ?

| ? | ?

|===

===== Other Things to Consider (Add-ons)

NOTE: What could I have done better? I think I could use one of the power boards
like 'DockerPi power board' with momentary switch for safe shutdown. Or even
couple Geekworm X828 SATA board (made by SupTronics Technologies) with their
X710 power board. With those I wouldn't need internal USB hub and 12vDC to 5vDC
internal step down converter.

See:

https://geekworm.com/collections/raspberry-pi-4/products/raspberry-pi-x710-power-management-with-wide-voltage-input-6v-to-36v-safe-shutdown-expansion-board

https://geekworm.com/collections/raspberry-pi-4/products/raspberry-pi-x828-stackable-2-5-sata-hdd-ssd-shield


* RTC Clock
* Opto couplers for NMEA interfaces
* Safe power down method
* Boot from USB SSD
* Coaxial Lightning Arresters for RF cables
* Add AmpMeter to Front Panels

.Amp Meter Wiring Diagram
image::amp-meter-wiring.jpg[alt="Amp Meter Wiring Diagram"]


==== Testing Boat Computer and Cockpit Display

===== OpenCPN 5.0.522

.OpenCPN MBTiles
image::opencpn-1.png[alt="OpenCPN MBTiles"]

{zwsp} +

.OpenCPN Vector
image::opencpn-2.png[alt="OpenCPN Vector"]

===== Power Usage

* Preliminary tests show that combined power consumption of Raspberry Pi 4 based boat computer and
Argonaut M7 gen2 7-inch touch display stays under 10 watts.
If I turn off the display then wattage drops to 4-4.5 watts. If I reduce the brightness on the display backlight
it drops dramatically as well. So both display and Pi contribute about the same share in power consumption.
On average I see their combined draw of 0.55 amps at 12v (about 7 watts). This is with 2 chained USB hubs
and long wires (HDMI/USB/power) between a computer and cockpit display and hub, AIS (dAISy), RTL-SDR (plugged in but
idling), Flashdrive SSD, FTDI (connected only into USB).
* 10 watts on 80 amp-hours 12v battery (in my understanding they are rated for that before drop below 10v,
so it is all usable amps) will give you approximately 80*12/10=96 hours of chartplotting at max brightness. C'est la vie.
That's why you need solar panels on your sailboat.
* While experimenting with power usage and connecting Argonaut M7 to different USB ports and hubs (USB2, USB3)
it became unresponsive. Even its own power on/off button didn't work. I had to perform a hardware reset of it.
* The reset procedure as per manufacturer requires to hold power button on Argonaut M7 display immediately after
full power off/on cycle. On my boat it's really a two-man job then. There is no power switch in cockpit because
the M7 display has its own and the other switch to power it on is below deck. It seems they didn't think about
single handed sailors when they came up with this reset procedure design.
* Turns out if I turn off 12v supply into cockpit it does turn-off the display but it's LED status light still stays on.
So it still gets some power via USB (not much per amp meter). Apparently this is the default behavior of most self powered
USB hubs to draw for the host when they lose own power supply. There are some who have this behavior configured
by a jumper on their PCB, but the default is to power itself from the host.
* I did test fiber-optic USB data cable leading to the cockpit as well. It does have regular wires for power as well, so
it behaves exactly the same. The cable is much thinner so you can have a smaller hole is your boat in a cockpit deck.

===== Assembly Activities

Make sure you use correct tools for:

* Gluing
* Soldering
* Screwing

=== Cockpit Display and Chartplotter

.Cockpit Display Diagram
image::cockpit-display.svg[alt="Cockpit Display Diagram"]

{zwsp} +


[cols="4", options="header"]
|===



|Item
|Description
|Cost
|Source



| NavPod
a| NavPod GP2300

| $225, Shipping: $9 | anchorexpress.com



| 5V/6V 3A Switch-mode UBEC, Max 5A Lowest RF
a|
https://www.amazon.com/dp/B008ZNWOYY

| $3 | Amazon



| Waterproof touch screen
a| Argonaut M7-gen2 + Water Sealed back

https://www.argonautcomputer.com/products/m7-smart-touch-monitor

| $518 | argonautcomputer.com



| DC Wire to cockpit
a| Marine Wire

https://www.amazon.com/dp/B01FRK09OY

| $25.50 | Amazon



| Female to Female HDMI adapter
a|
* Compatible with HDMI standard (4K video at 60 Hz, 2160p, 48-bit/px color depth)
* Supports bandwidth up to 18Gbps
* backwards compatible with earlier versions

https://www.amazon.com/dp/B07K6HKD8S

| $4.75 | Amazon



| Standard Horizon MMB-97 Flush Mount Kit for Explorer GX1600/GX1700

a|
https://www.amazon.com/dp/B004NZOV8A

| $16.50 | Amazon



| USBGear 4-Port USB 3.0 Mountable Charging and 5Gbps Data Hub

a|
* Supports Super-Speed USB 3.0 over each port with transfer rates up to 5Gbps.
* Power Adapter: 5V 2A output, 100-240V, 50/60Hz 0.40A

https://www.amazon.com/dp/B012DZ4NJ8

| $29 | Amazon



| USB 3.0 Extension Cable 20ft, Hftywy USB Type A Male to Female Extension Cord 5Gbps Data Transfer, Red

a|
https://www.amazon.com/dp/B07XF3GM1W

NOTE: Consider also fiber optic USB 3.0 active extension cables

| $13 | Amazon


| Long HDMI Cable
a| Postta HDMI Cable(25 Feet) Ultra HDMI 2.0V Cable with 2 Piece Cable Ties+2 Piece HDMI Adapters
Support 4K 2160P,1080P,3D,Audio Return and Ethernet, Blue

https://www.amazon.com/dp/B075YPT2F1

NOTE: Consider also fiber optic HDMI cables

| $14 | Amazon



| Air Mouse and wireless keyboard and touchpad
a|
H18+ 2.4Ghz Mini Wireless Keyboard Touchpad Combo with 3 Level Backlit Rechargeable Full Screen Mouse Remote Control
for Android TV Box, Projector, IPTV, HTPC, PC, Laptop

https://www.amazon.com/dp/B0776T8QDC

| $20 | Amazon



| AcuRite 02020 Portable Lightning Detector
a|
* Detects lightning bolts and storms within 25 miles
* Warning light, audible alarm and text alerts

https://www.amazon.com/dp/B00EO1H3X8

| $30 | Amazon



| Wireless Phone Charger and Holder
a| ScanStrut ROKK Wireless - Active (SC-CW-04E) 12v / 24v Waterproof Wireless Phone Charging Mount

https://scanstrut.com/products/waterproof-wireless-charge/rokk-sc-wc-04-detail

| $97.60 | hodgesmarine.com


|===

{zwsp} +

=== Boat Gateway Box

The second box is a boat LTE/WiFi/IoT gateway device and it is an extension to the boat computer.
In case if you do not need HDMI display you might need only the boat gateway because the boat gateway runs its own KPlex
server under OpenWrt Linux. The boat gateway has M5Stack ESP32 micro-controller and is capable to connect to NMEA
(if you customize if a bit further). The boat gateway is connected to the boat computer via Ethernet.
The boat gateway uses the same type of an enclosure as the boat computer.

Features of the boat gateway box:

* WiFi Gateway (connecting to marina's WiFi and on-shore WiFi hot-spots via a long range WiFi antenna)

* LTE / 4G Gateway (providing a boat with Internet and voice access within the zone of reception
of a cellular network)

* VPN gateway

* Ethernet Hub

* Network Access Storage, Network back-up

* M5Stack ESP32 Controller and 3-Buttons LCD display (panel mounted, numerous optional M2Stack add-ons)

* KPlex server running on router's OpenWrt Linux

* GPS NMEA 0183 talker via KPlex

* IoT gateway with MQTT

* Voltage and Amperage Display to monitor power consumption

* Any other additional sensors and devices can be added via M5Stack. M5Stack is programmable micro-controller without
an operating system but very capable of running complex programs

==== Boat Gateway Front Panel

* Power On/Off Switch

* Router Power On/Off Switch

* Panel Mounted Fuse Box

* Panel Mounted M5Stack LCD Display with 3 Buttons

* USB 2.0 Port RJ45 connected to M5Stack

* Amp and Volt Meter


.Boat Router Front Panel View
image::boat-router/router-front-panel-1.jpg[alt="Boat Router Front Panel View", width="75%", align="center"]

{zwsp} +

.Boat Router Front Panel Wiring
image::boat-router/router-front-panel-2.jpg[alt="Boat Router Front Panel Wiring", width="75%", align="center"]

{zwsp} +


==== Boat Gateway Back Panel

* SAE power (red/black, red male) 12V connector with waterproof gland to boat 12v

* Two SMA coax connectors to external cellular LTE antennas

* SMA RP coax connector for external long range WiFi antenna

* SMA coax connector to external active GPS antenna

* Three Ethernet Ports with water tight caps for LAN

* Ethernet port with water tight cap for WAN


.Boat Router Back Panel View
image::boat-router/router-back-panel-1.jpg[alt="Boat Router Back Panel View", width="75%", align="center"]

{zwsp} +

.Boat Router Back Panel Wiring
image::boat-router/router-back-panel-2.jpg[alt="Boat Router Back Panel Wiring", width="75%", align="center"]

{zwsp} +


==== Inside Boat Gateway

{zwsp} +

.Boat Router Inside
image::boat-router/router-inside.jpg[alt="Boat Router Inside", width="75%", align="center"]

{zwsp} +

.Boat Router Inside Top
image::boat-router/router-inside-1.jpg[alt="Boat Router Inside Top", width="75%", align="center"]

{zwsp} +

.Boat Router Inside Bottom
image::boat-router/router-inside-2.jpg[alt="Boat Router Inside Bottom", width="75%", align="center"]

{zwsp} +

[cols="4", options="header"]
|===



|Item
|Description
|Cost
|Source



| WiFi Router (not needed if you go with GL-X750 option)
a|
GL.iNet GL-AR750 Travel AC Router, 300Mbps(2.4G)+433Mbps(5G) Wi-Fi, 128MB RAM, MicroSD Storage Support, OpenWrt/LEDE

* OpenWrt/LEDE (open source)
* OpenVPN client pre-installed
* 128MB RAM, up to 128GB MicroSD slot, USB 2.0 port, three Ethernet ports, and optional PoE module

https://www.amazon.com/dp/B07712LKJM

| $45 | Amazon



| LTE 4G/3G and Wifi Router (GL-AR750 is not needed if you pick this)
a| GL.iNet Spitz (GL-X750) 4G Router & 4G Modem (with Sim card slot) for your area and cellular provider

* Transfer 4G LTE signal to Wi-Fi, 5G (433Mbps), 2.4G(300Mbps) Wi-Fi, 4G (EC25, EP06) PCIe modules
* Powered by Atheros AR9531, @650Mhz
* 2 x 4G LTE external antennas, 2dBi 5G & 2.4G internal antennas
* Interface: 1WAN, 1LAN, 1USB2.0, 1 MicroSIM slot, 1 MicroSD slot
* OPEN SOURCE & PROGRAMMABLE: OpenWrt/LEDE, OpenVPN pre-installed
* 12v input power

https://www.gl-inet.com/products/gl-x750/

| $119 + Modem: $20 + (Optional bluetooth module and wall mount): $16 | gl-inet.com



| Long Range WiFi Antenna
a|
Lysignal Outdoor Omni Directional Antenna Fiberglass 2.4GHz 8dBi N Female Connector for Cell
Phone Signal Booster, WiFi Router

* Complies with all 802.11n/b/g (2.4GHz) products
* High power, high gain outdoor wifi antenna. Extend coverage of a wireless network in all directions
* Waterproof, striking resistant, anti-corrosion
* RP (reverse polarity) SMA connector

https://www.amazon.com/dp/B07PG8RPSL

NOTE: This has RP SMA connector, so corresponding panel mount part will need to be RP SMA.

| $36 | Amazon


| LTE/4G/3G Antenna
a|
700~2600mhz 88dbi 3g 4g Lte Antenna Mobile Antenna 2 * SMA Male Connectors Booster Mimo Panel Antenna, 5 Meters

* Indoor
* Wall mount

https://a.aliexpress.com/2iIG1Kc0

| $15.10 | AliExpress



| M5Stack Core
a|ESP32 Basic Core IoT Development Kit

* ESP32 micro controller
* Integrated 802.11b/g/n HT40 Wi-Fi transceiver, baseband, stack and LWIP
* Bluetooth, BLE
* 4 MByte flash + 520K RAM
* Speaker, 3 Buttons, LCD(320*240), 1 Reset
* 10x capacitive touch interface

https://m5stack.com/collections/m5-core/products/basic-core-iot-development-kit

| $28 | m5stack.com



| M5Stack LAN Module Base
a|LAN is a M5 Base that having a W5500 chip, which is a Hardwired TCP/IP embedded
Ethernet controller that provides easier Internet connection to embedded systems.
This Base is specifically
designed for industrial application scenarios, comes with couple of HT3.96 connectors

* Input Supply Voltage: 9-24V
* HT3.96 port for supporting RS485
* TTL-to-RS485 adapter board

https://m5stack.com/products/lan-module

https://m5stack.com/collections/m5-base/products/lan-module

| $14 | m5stack.com



| M5Stack Panel Mount Accessory
a|FRAME Panel Extended Install Components (2 Sets)

https://m5stack.com/collections/m5-accessory/products/frame-panel-extended-install-components

| $3.40 | m5stack.com


|===

.M5Stack ESP32 Controller Board
image::m5stack-board.jpg[alt="M5Stack Board", width="75%", align="center"]

{zwsp} +

"M5Stack" stands for "Modular 5cm Stackable".

Looks like waterproof version is already in works.

See: https://twitter.com/m5stack/status/1164091308895457280?lang=en


.M5Stack LCD and Communication Module
image::m5stack-lcd.jpg[alt="M5Stack LCD", width="75%", align="center"]

{zwsp} +

===== GL-AR750 Router Modifications

The AR-750 router needs to be modified to add external 2.4GHz antenna. Test U.FL connectors need to be removed
and real ones should be soldered. The existing U.FL connector is used by internal 5G band antenna.
See here:

https://www.arednmesh.org/comment/12706#comment-12706

===== GL-X750 (Spitz) Router Modifications

You get this router with the modem you selected for your region. My modem is Quectel EP06-A.
EP06-A has 3 antenna connectors. One is connected to external LTE antenna connector, another one
is Rx Diversity antenna to external connector and middle one is GPS antenna not connected. You can open up router
by unscrewing two screws under serial number sticker (it's easy to remove and put back after).
I've just put another coax cable to GPS antenna connector and cut a bit of plastic in the case just
enough to put that cable through (SMA side on outside).

.GL-X750 Antenna Mod
image::gl-x750.jpg[alt="GL-X750 Antenna Mod", width="75%", align="center"]

{zwsp} +

.GL-X750 Case Mod
image::gl-x750-antenna-mod.jpg[alt="GL-X750 Screws", width="75%", align="center"]

{zwsp} +

The modem is controlled via 'AT' commands.

Make sure you connect antennas first before activating SIM card in the network or you might get error like:

 SIM card not registered

APN for AT&T has to be set to "broadband".
Device: /dev/ttyUSB2
Service: LTE/UMTS/GPRS


To enable the GPS you have to use

 AT+QGPS=1

command on /dev/ttyUSB2 and then one can read the nmea sentences on /dev/ttyUSB1.
There are additional commands to configure the GNSS functions, but they’re very limited compared
to “regular GNSS chips”. The details can be found in the Quectel EP06&EG06&EM06 GNSS AT Commands Manual.
(Registration required to download)

The command to reset the modem to factory defaults is

 AT+QPRTPARA=3

The router is running linux. While setting it up you can login into it like this:

 ssh root@192.168.8.1

The password would be the one you set in web UI.

Hmm:
There is even KPlex for OpenWrt. I think this GPS can be fed into OpenPlotter from the router!

https://github.com/caesar/kplex-openwrt

And you can install KPlex on a router (precompiled) from the router itself!

{zwsp} +

.KPlex on OpenWrt Router
image::KPlex-OpenWrt-Router.png[alt="KPlex on OpenWrt Router"]

{zwsp} +

AT command for the GPS needs to be run every time on boot. This needs to be scripted.
Install the program called 'socat'. With it you can send commands to the modem from command line.

 echo "AT+QGPS=1" | socat - /dev/ttyUSB2,crnl

----

[serial]
name=gps
filename=/dev/ttyUSB1
direction=in
baud=9600
strict=no

[tcp]
name=router
mode=server
port=10110
direction=out

----


Add startup script

----

cat > /etc/init.d/modem-gps-init
#!/bin/sh  /etc/rc.common

START=98

start()
{
     echo "AT+QGPS=1" | socat - /dev/ttyUSB2,crnl
}

^D

chmod 755 /etc/init.d/modem-gps-init

----

Another modification: By default in GL-X750 one Ethernet port is set up as WAN and another is LAN.
You can reassign them both as LAN. It is done in web UI of the router.
One LAN port will go to main boat computer and another lan port you can connect to M5Stack LAN base module.
Or even have a ethernet hub inside if you plan bigger boat LAN (in that case you can leave one port as WAN and
connect the router via hub).

GL-X750 aka Spitz router power supply is 12v (No need for buying step-down converter).

NOTE: If you just need chart plotter capabilities it seems you do not even need raspberry pi. You could just install
KPlex on GL-X750 router make sure the modem you picked when you buy the router has GPS. And then you use
OpenCPN installed on an android tablet connected via WiFi to KPLex. And with this you have LTE internet on your boat
and local private WiFi.

NOTE: FlashDrive Stick inserted into the router USB port is automatically shared on network via samba. You should
mount it using this command:

[source, shell]
------
sudo mount -t cifs //gl-x750/SamsungUSB /media/Share -o user=guest,vers=1.0
------

===== Local WiFi, VNC, etc

====== VNC

https://www.realvnc.com/raspberrypi/

===== WiFi Gateway

https://www.gl-inet.com/products/gl-ar750/

====== OpenVPN

https://openvpn.net/

====== OpenWrt

https://openwrt.org/

====== LongFi Helium

https://www.helium.com/

===== Boat IoT, MQTT, M5Stack

====== MQTT

http://mqtt.org/

http://mosquitto.org/

====== M5Stack ESP32

https://m5stack.com/

====== RTL 433

https://github.com/merbanan/rtl_433

===== Boat Cellular LTE Voice and Data Gateway

====== SMS

====== OpenAirInterface

https://www.openairinterface.org/

==== Testing the Boat Gateway

{zwsp} +

.Boat Router Testbed
image::boat-router/boat-router-testbed.jpg[alt="Boat Router Testbed", width="75%", align="center", rotate]

{zwsp} +

.Boat Router LTE Speed
image::boat-router/boat-router-lte-speed.jpg[alt="Boat Router LTE Speed", width="75%", align="center"]

===== Good

* LTE speed is good even with two little antennas it came with.
* Time to acquire a GPS location fix is very short with external antenna. I do not have exact time but it's under
few minutes even inside the house. Having external GPS antenna made a huge improvement.
* Power usage of the whole gateway box in well under 2 watts. 2 watts is under speed stress test with uploads over LTE.

===== Not so good

* External WiFi antenna (the one from the bill of material) did very little to improve the range. (Again I've tested
it inside the house, without placing the antenna outside). My modification of the connector inside the router and soldering
it might have been not good so you might have better results.
* Bigger LTE antenna (again from the bill of material) didn't give better signal quality (even a bit lower) than
original antennas supplied with Spritz router. (Could be different picture on other bands though). With either of
antennas LTE performed well.


==== Other Ideas

Rudder Position project

https://hackaday.io/project/168592-opencpn-chart-plotter-w-autopilot-and-waypoints

== Boat Software

=== Software Data Flow

.Software Architecture
ifdef::env-github[image::software-arch.svg[Software Architecture]]
ifndef::env-github[]

[plantuml,software-arch,svg]
....
!include plantuml/software-arch.puml
....

endif::[]

{zwsp} +

{zwsp} +

=== Network Diagram

.Network Diagram
ifdef::env-github[image::network-arch.svg[Network]]
ifndef::env-github[]

[plantuml,network-arch,svg]
....
!include plantuml/network-arch.puml
....

endif::[]

=== Important local URLs on your boat

=== Openplotter

==== Installation

==== Initial Settings

=== Geolocation

=== Charts and OpenCPN

==== Touch Screen

One of the issues that kept bugging me was the lack of multitouch support on a touchscreen
in OpenCPN and Raspbian UI in general. Well there is a fix! The solution requires the program called 'twofing'.
It is easy to install. I've combined the script for my Argonaut M7 waterproof display.

See: https://github.com/bareboat-necessities/my-bareboat/blob/master/twofing/rpi_twofing_install.sh

Now zooming works with two fingers, there is a right click emulation with two fingers touch as well.
With few modifications it can work for other screens. You will need to find out vendorID, productID and
name for your touch screen display.
I have Argonaut M7 gen2 screen. It gives me VendorID: 0000, ProductId: 0009, Name:
'Argonaut. Touchscreen'.
For Argonaut M7 gen1 I've seen in posts VendorID: 04d8, ProductId: f724
and reported device name as 'Microchip Technology, Inc.'.

Another issue with twofing and Chromium browser is that latest Chromium browser does handle multi touch
fine by itself and twofing interferes with that. To fix that you need to add "chrome" into 'profiles.h'
'blacklist' variable in twofing code. Edit 'profiles.h', recompile it and copy into /usr/bin/ :

[source, shell]
------
rm *.o twofing
make
sudo cp twofing /usr/bin/
------

One more issue is entering the text on a touchscreen. I've added virtual on screen keyboard. I've compared
several and the one I liked the most is svkbd.

I've made a script to install it.
See: https://github.com/bareboat-necessities/my-bareboat/blob/master/svkbd/rpi_svkbd_install.sh

With 'twofing' fix and an on-screen svkbd keyboard OpenCPN is much more usable on my touch screen display.
Smooth Panning/Zooming, OpenGL, and Touchscreen should be all enabled in OpenCPN settings.

The sound didn't work out of aux port. By default Raspberry Buster uses HDMI audio output and Argonaut M7 doesn't
have a speaker. This command switches it to aux (You will need to add it into linux startup scripts if you
want it on every boot):

[source]
-----
amixer cset numid=3 1
-----


=== Compass / IMU / Barometer / Thermometer

=== AIS

=== Weather

There are multiple ways to receive weather predictions:

* Download GRIB files via internet. (Only works if internet is available).

* GRIB files via SSB radio (out of scope here)

* Weather FAX (some people just connect radio to computer audio input, record audio file and covert it
using utility into image). It would be nice to completely automate this process using RTL-SDR.
+
See: https://www.rtl-sdr.com/tag/weather-fax/

* Images from NOAA satellites via radio. RTL-SDR can be used to automate this as well.
+
See: https://www.instructables.com/id/Raspberry-Pi-NOAA-Weather-Satellite-Receiver/



=== NMEA Wind Sensor


== Pole for Sailboat Solar Panel / Wind Generator

This is no welding, no bends solution. The pole is built from universal stainless steel marine components.
To reproduce this design you would need only a pipe cutter tool and a drill.
The top is quick release adjustable angle (two axis). Removable for winter storage.
The solar panel is quickly detachable and removable.

[.text-center]

.Solar Panel/Wind Generator/Radar Pole Mast for Sailboat
image::solar-panel-wind-generator-radar-sailboat-pole-mast.png[alt="Solar Panel/Wind Generator/Radar Pole Mast for Sailboat", width="75%", align="center"]

{zwsp} +

[.text-center]

.Solar Panel/Wind Generator/Radar Pole Mast for Sailboat View
image::solar-panel-wind-generator-radar-sailboat-pole-mast-2.jpg[alt="Solar Panel/Wind Generator/Radar Pole Mast for Sailboat View", width="75%", align="center"]

{zwsp} +

== Third-Party Projects

=== Boat Chartplotter using stick PC

https://www.youtube.com/watch?v=JYhsQSQOEbM&feature=youtu.be

Marine Chartplotter PC - Open CPN on ASUS QM1

=== Sailing with Linux (NMEA, GPSd, Iridium) – Agile For Life

https://agile4life.blog/2018/07/16/sailing-with-linux-nmea-gpsd-iridium/

Instructions on connecting Satellite Iridium phone to Pi for satellite data services.

=== RaspEx

http://raspex.exton.se/?p=1234

Another Raspberry Pi Boating Project

== Links

* https://opencpn.org/[OpenCPN]

* https://cloudsmith.io/~dan-dickey/repos/opencpn-raspbian-unstable/packages/[OpenCPN dev builds for Pi]

* http://sailoog.com/openplotter[OpenPlotter]

* https://www.rooco.eu/[Moitessier HAT]

* https://pypilot.org/[PyPilot]

* https://www.rtl-sdr.com/[Rtl Sdr Blog]

* http://signalk.org/[SignalK]

* http://www.stripydog.com/kplex/[KPlex]

* https://github.com/canboat[CAN Boat]

* https://squidd.io/squiddio_pi[Squidd.io as an OpenCPN plugin]

* https://github.com/sarfata?tab=repositories[KBox and other boat software]

* https://github.com/ttlappalainen?tab=repositories[NMEA2000 Libraries]

* http://openskipper.org/[OpenSkipper]

* https://marinux.tuxfamily.org/[Marinux]

* https://www.raspberrypi.org/[RaspberryPi]

* https://m5stack.com/[M5Stack]

* https://github.com/m5stack/[M5Stack on GitHub]

* https://www.openairinterface.org/[OpenAirInterface]

* https://openwrt.org/[OpenWrt]

* https://mosquitto.org/[Mosquitto MQTT Broker]

* https://nodered.org/[NodeRed]

* https://github.com/merbanan/rtl_433[IoT RTL 433]

* https://www.openscad.org/[OpenSCAD]

* https://www.nasamarine.com/product/clipper-wireless-wind/[NASA Marine Wireless Wind Instrument]

* https://rigpi.net/[RigPi]

* https://github.com/martinber/noaa-apt[NOAA APT weather satellite image decoder, for Linux, Windows, RPi 2+ and OSX]

{zwsp} +

toc::[]



